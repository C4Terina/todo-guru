= Cloud computing and services 
:toc:
:toc-title: Table of contents 

:source-language: yaml

image::./assets/uniwa-logo.jpg[width=40%, align=center]

.Lab exercise - Docker & Microservices 

[NOTE]
****
[.text-center]

****

== Students 

* Μάριος Παπάζογλου ~ ice21390179
* Αικατερίνη Παπαχριστούλου ~ ice19390185

== Intro

=== Application description 
Todo-guru is a microservice application built using Go as the API backend and MariaDB as the database management system. 
It provides a very simple API for creating and managing todo items and user management functionality. 
This allows users to create accounts, login, and manage their own todo items.

=== Installation

* Install [Docker](https://docs.docker.com/engine/install/)
* Install [Docker compose](https://docs.docker.com/compose/install/)
* Check link:./INSTALL.adoc[INSTALL.adoc]

== Chapter 1: Building the CLIENT

The client is an essential component of our application, as it provides the interface through which users can interact with our system. 
It can take many forms, ranging from a traditional web interface to a command-line interface (CLI) or even a mobile app.

In our case, we chose to build a terminal user interface (TUI) using the tview library for Go. 
The TUI provides a highly productive and vim-like environment for interacting with our system,
which can be especially appealing to power users and developers who prefer keyboard shortcuts and minimalistic interfaces.

Overall, our goal with the client was to create an intuitive and efficient interface that would allow users to quickly and easily manage their tasks within our application.

== Chapter 2: Building the API

Our API is built using the powerful and lightweight chi router,
which is a popular minimalist choice. We will be creating several endpoints that allow users to interact with our application,
including the ability to register, log in, create, delete and update tasks.

image::https://katcipis.github.io/img/gohacking.jpg[width=40%, align=center]

Our API is designed to be efficient and scalable, with a focus on simplicity and ease of use. The use of HTTP methods such as POST, DELETE, PATCH, and GET 
allow for clear and concise communication between the client and the server, while maintaining RESTful principles.

[source, go]
----
r.Route("/api", func(r chi.Router) {
    r.Post("/register", RegisterHandler(db))
    r.Post("/login", LoginHandler(db))
    r.Post("/create_task", CreateTask(db))
    r.Delete("/delete_task", DeleteTask(db))
    r.Patch("/update_task", UpdateTask(db))
    r.Get("/gather_tasks", GatherTasks(db))
    r.Get("/", func(w http.ResponseWriter, _ *http.Request) {
        w.Header().Set("Content-Type", "application/json")
        w.WriteHeader(http.StatusOK)
        w.Write([]byte("Hello World"))
    })
})
----

In the code block above, you can see how we use the chi.Router to define our endpoints. We use r.Post to handle the registration, login, 
and task creation endpoints, r.Delete to handle task deletion, r.Patch to handle task updates, and r.Get to handle task retrieval.
We also define a simple Hello World endpoint for health check. The db object is passed as a parameter to each of the handlers, allowing them to interact with the database.

By using the chi router, we can easily define our endpoints and map them to the appropriate handlers, keeping our code organized and easy to maintain.

== Chapter 3: Building the Database

The application uses a MariaDB as storage. MariaDB is a FOSS (Free and Open Source Software) community-driven fork of the MySQL, 
providing a more minimal and faster alternative to its predecessor.

image::./db/db-schema.png[]

to initialize the database you need the script below 

[source, sql]
----

CREATE DATABASE IF NOT EXISTS tododb;

USE tododb;

GRANT SELECT, INSERT, UPDATE, DELETE ON tododb.* TO 'user'@'%';

CREATE TABLE IF NOT EXISTS users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(255) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    INDEX idx_username (username)
);

CREATE TABLE IF NOT EXISTS tasks (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    description VARCHAR(255) NOT NULL,
    completed BOOL NOT NULL DEFAULT false,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_user_id (user_id),
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);
----

== Chapter 4: Integrating the components 

To integrate these components, we are using the chi router to create endpoints that map to API routes. 
Each endpoint will call a handler function that interacts with the database using SQL queries. The API endpoints will also return JSON data to the client.

== Chapter 5: Compose the services 

